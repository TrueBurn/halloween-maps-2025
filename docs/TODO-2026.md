# TODO for Halloween Maps 2026

## Priority Items

### üî¥ CRITICAL: PostHog Event Management

**Problem:** Hit 1 million free tier events the day after Halloween 2025.

**Solutions to implement:**

1. **Event Scrubbing/Cleanup Tool**
   - [ ] Add admin tool to delete PostHog events by date range
   - [ ] Create "Reset Events" button in analytics dashboard
   - [ ] Add confirmation dialog with event count preview
   - [ ] Schedule automatic cleanup of old test events
   - [ ] Document process for pre-event cleanup in `ADMIN-SETUP.md`

2. **Event Optimization**
   - [ ] Review all tracked events and remove unnecessary ones
   - [ ] Reduce event frequency for high-volume actions:
     - [ ] Map interactions (consider sampling or debouncing)
     - [ ] User location updates (reduce frequency or sample)
     - [ ] Filter applications (only track unique combinations)
   - [ ] Use event sampling (track 1 in N events for high-volume actions)
   - [ ] Add environment check to disable analytics in development

3. **Cost Management**
   - [ ] Set up PostHog usage alerts (80%, 90%, 95% of quota)
   - [ ] Create backup plan if quota exceeded during event
   - [ ] Consider PostHog paid tier or alternative analytics (evaluate cost vs benefit)
   - [ ] Document expected event volume based on 2025 data

4. **Event Audit**
   - [ ] Review which events are actually useful for insights
   - [ ] Keep only high-value events:
     - ‚úÖ Page views (essential)
     - ‚úÖ Location clicks (essential)
     - ‚úÖ Directions requests (essential)
     - ‚úÖ GPS permission (essential)
     - ‚ùì Filter applications (evaluate - may be too frequent)
     - ‚ùì Map interactions (evaluate - may need sampling)
     - ‚ùì User location updates (evaluate - reduce frequency)
   - [ ] Remove or sample low-value events

---

## Performance & Optimization

### Analytics
- [ ] Add event sampling configuration (env var: `NEXT_PUBLIC_ANALYTICS_SAMPLE_RATE`)
- [ ] Implement client-side event batching (send in groups vs individual)
- [ ] Add analytics opt-out for admins during testing
- [ ] Cache PostHog queries more aggressively (increase from 30-60s to 5-10min)

### Map Performance
- [ ] Test with 500+ simultaneous users (load testing)
- [ ] Optimize marker clustering for high-density areas
- [ ] Consider map tile caching strategy
- [ ] Review heatmap rendering performance with large datasets

---

## Features & Enhancements

### Movement Timeline
- [ ] Add date picker to view historical timelines
- [ ] Export timeline data as video/GIF for social media
- [ ] Add heatmap intensity controls
- [ ] Show movement trails between intervals

### Analytics Dashboard
- [ ] Add year-over-year comparison (2025 vs 2026)
- [ ] Create downloadable reports (PDF/Excel)
- [ ] Add real-time dashboard for event night monitoring
- [ ] Track route popularity (which age groups most active)

### Admin Tools
- [ ] Bulk import locations from CSV
- [ ] Location templates (save common configs)
- [ ] Neighborhood boundary visualization on map
- [ ] Historical data archive before event

### User Experience
- [ ] Add push notifications for route updates (if users opt-in)
- [ ] Offline mode for map caching
- [ ] Share specific routes via link
- [ ] Print-friendly route maps

---

## Technical Debt

### Testing
- [ ] Increase test coverage beyond utility functions
- [ ] Add E2E tests for critical paths (Playwright/Cypress)
- [ ] Load testing for event night traffic
- [ ] Test PostHog failover scenarios

### Documentation
- [ ] Add deployment runbook with step-by-step checklist
- [ ] Document PostHog event schema
- [ ] Create troubleshooting guide for common issues
- [ ] Video walkthrough for admin setup

### Infrastructure
- [ ] Set up staging environment for both neighborhoods
- [ ] Automated deployment pipeline (CI/CD)
- [ ] Database backup strategy
- [ ] Monitor Vercel bandwidth usage

---

## Pre-Event Checklist (September 2026)

### 1-2 Months Before
- [ ] Clean up PostHog events from previous year
- [ ] Review and optimize event tracking code
- [ ] Test with realistic data volumes
- [ ] Update dependencies and security patches
- [ ] Review Vercel and Supabase quotas/limits

### 1 Month Before
- [ ] Deploy to production with fresh data
- [ ] Train neighborhood admins on new features
- [ ] Create event day monitoring dashboard
- [ ] Set up usage alerts (PostHog, Vercel, Supabase)

### 1 Week Before
- [ ] Final testing with actual routes
- [ ] Verify all integrations (PostHog, Supabase)
- [ ] Confirm admin access for both neighborhoods
- [ ] Prepare rollback plan

### Event Day
- [ ] Monitor analytics in real-time
- [ ] Watch PostHog event quota
- [ ] Monitor Vercel function execution times
- [ ] Have backup contact method if app goes down

### Day After
- [ ] Download raw analytics data for archival
- [ ] Export location data and participation stats
- [ ] Create summary report for admins
- [ ] Document issues encountered for next year

---

## Ideas to Evaluate

### Low Priority
- [ ] Multi-language support (if neighborhood becomes more diverse)
- [ ] Weather integration (show real-time weather on event day)
- [ ] Photo sharing feature (users upload candy haul pics)
- [ ] Gamification (badges for completing routes)
- [ ] Integration with local charities for donation tracking

### Research Needed
- [ ] Alternative to PostHog (self-hosted analytics?)
- [ ] Progressive Web App (PWA) for offline support
- [ ] Native mobile app vs web (evaluate cost/benefit)
- [ ] MapCN/MapLibre GL for map components ([GitHub Issue #3](https://github.com/TrueBurn/halloween-maps-2025/issues/3))
  - See detailed analysis: [MAPCN-EVALUATION.md](./MAPCN-EVALUATION.md)
  - Consider if: Performance issues arise or major redesign planned
  - Current verdict: Keep Leaflet (works well, migration ~20-30 hours)

---

## Lessons Learned from 2025

### What Worked Well ‚úÖ
- Dark Halloween theme was well-received
- Marker clustering prevented visual clutter
- Time range selector on heatmap very useful
- Movement timeline provided great insights
- Real-time updates worked smoothly
- Mobile-first design paid off

### What Needs Improvement ‚ùå
- PostHog free tier insufficient for event scale
- No pre-event analytics cleanup process
- Some events tracked too frequently
- No load testing before event
- Missing usage alerts/monitoring

### Analytics from 2025
- Total unique users: [FILL IN FROM ACTUAL DATA]
- Peak concurrent users: [FILL IN FROM ACTUAL DATA]
- Total events tracked: ~1 million (hit quota)
- Most popular location types: [FILL IN FROM ACTUAL DATA]
- Peak activity time: [FILL IN FROM ACTUAL DATA]
- Average session duration: [FILL IN FROM ACTUAL DATA]

---

## Migration Notes

### Breaking Changes to Consider
- If changing PostHog setup, need migration plan for both neighborhoods
- If adding new required env vars, update deployment docs
- If changing database schema, coordinate migrations across both projects

### Data Retention
- Keep 2025 location data archived for reference
- Export 2025 analytics before cleanup
- Document participation rates year-over-year

---

**Last Updated:** 2025-11-02
**Review Date:** September 2026
**Owner:** Project maintainer

---

## Quick Action Items for Right Now

1. **ASAP:** Export 2025 analytics data before it gets deleted
2. **ASAP:** Document actual event metrics (fill in [FILL IN] sections above)
3. **This week:** Review PostHog events and identify candidates for removal
4. **This month:** Research PostHog event deletion API/tools
5. **Next month:** Implement event sampling for high-volume actions
